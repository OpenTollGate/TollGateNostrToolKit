# We probably want to disallow ssh passwords if running on a public VPS

if grep -q -i "hypervisor" /proc/cpuinfo; then

    echo "Likely running on a virtual machine and not a router."

    uci set dropbear.@dropbear[0].PasswordAuth='off'
    uci set dropbear.@dropbear[0].RootPasswordAuth='off'
    uci commit dropbear
    /etc/init.d/dropbear restart

    #remove lan interface and add a wan interface on a vps
    # /etc/config/network
    uci del network.lan
    uci set network.wan=interface
    uci set network.wan.proto='dhcp'
    uci set network.wan.device='eth0'

    uci add firewall rule
    uci set firewall.@rule[-1]=rule
    uci set firewall.@rule[-1].name='Allow-public-SSH'
    uci set firewall.@rule[-1].enabled='true'
    uci set firewall.@rule[-1].src='wan'
    uci set firewall.@rule[-1].dest_port='22'
    uci set firewall.@rule[-1].proto='tcp'
    uci set firewall.@rule[-1].target='ACCEPT'
    uci commit firewall
    /etc/init.d/firewall restart




else
    echo "Probably on physical hardware or a router"
fi
